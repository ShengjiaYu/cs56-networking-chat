<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AePlayWave.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cs56-networking-chat</a> &gt; <a href="index.source.html" class="el_package">client.model</a> &gt; <span class="el_source">AePlayWave.java</span></div><h1>AePlayWave.java</h1><pre class="source lang-java linenums">package client.model;

import java.io.File; 
import java.io.IOException; 
import javax.sound.sampled.AudioFormat; 
import javax.sound.sampled.AudioInputStream; 
import javax.sound.sampled.AudioSystem; 
import javax.sound.sampled.DataLine; 
import javax.sound.sampled.FloatControl; 
import javax.sound.sampled.LineUnavailableException; 
import javax.sound.sampled.SourceDataLine; 
import javax.sound.sampled.UnsupportedAudioFileException; 
import java.net.URL; 

/** Class from anyexample.com of playing Sound File Asychronously
  
   From the original website's description (found at
   &lt;a href=&quot;http://www.anyexample.com/programming/java/java_play_wav_sound_file.xml&quot;&gt;http://www.anyexample.com/programming/java/java_play_wav_sound_file.xml&lt;/a&gt;
   )

   &quot;Our class extends Java Thread class to be asynchronous. There are two
   constructors - AePlayWave(String wavfile) with has only one argument -
   file name, and AePlayWave(String wavfile, Position p), which takes
   file name and Position constant, either Position.LEFT or
   Position.RIGHT -- this is simple balance control, which can toggle
   only left or right channel of stereo sound (useful for storing two
   different sounds in single wave file).
   
   Various javax.sound.sampled classes are used to prepare audio input
   stream and audio data line. Afterwards, we simply read and write
   (through 512Kb buffer, which is suitable for most formats) sound data
   from file to sound device.


  @author Adapted from http://www.anyexample.com/programming/java/java_play_wav_sound_file.xml
  @author P. Conrad (adapted to get resources from JAR file)
  @version Retrieved by P. Conrad on 06/03/2012

 */

public class AePlayWave extends Thread { 
 
    private String filename;
 
    private Position curPosition;
 
<span class="nc" id="L47">    private final int EXTERNAL_BUFFER_SIZE = 524288; // 128Kb </span>
 
<span class="nc" id="L49">    enum Position { </span>
<span class="nc" id="L50">        LEFT, RIGHT, NORMAL</span>
	    };
 
<span class="nc" id="L53">    public AePlayWave(String wavfile) { </span>
<span class="nc" id="L54">        filename = wavfile;</span>
<span class="nc" id="L55">        curPosition = Position.NORMAL;</span>
<span class="nc" id="L56">    } </span>
 
<span class="nc" id="L58">    public AePlayWave(String wavfile, Position p) { </span>
<span class="nc" id="L59">        filename = wavfile;</span>
<span class="nc" id="L60">        curPosition = p;</span>
<span class="nc" id="L61">    } </span>
 
    public void run() { 
 
<span class="nc" id="L65">	String fullFileName = &quot;/resources/&quot; + filename;</span>

<span class="nc" id="L67">	URL url = null;</span>
	try {
<span class="nc" id="L69">	    url = getClass().getResource(fullFileName);</span>
<span class="nc" id="L70">	} catch (Exception e) {</span>
<span class="nc" id="L71">            e.printStackTrace();</span>
<span class="nc" id="L72">            return;</span>
<span class="nc" id="L73">	}</span>

<span class="nc bnc" id="L75" title="All 2 branches missed.">	if (url==null) {</span>
<span class="nc" id="L76">	    System.err.println(&quot;Error: &quot; + fullFileName + &quot; could not be found through getClass().getResource() (i.e. in the JAR file or classpath)&quot;);</span>
<span class="nc" id="L77">	    return;</span>
	}
	
<span class="nc" id="L80">        AudioInputStream audioInputStream = null;</span>
        try { 
<span class="nc" id="L82">            audioInputStream = AudioSystem.getAudioInputStream(url);</span>
<span class="nc" id="L83">        } catch (UnsupportedAudioFileException e1) { </span>
<span class="nc" id="L84">            e1.printStackTrace();</span>
<span class="nc" id="L85">            return;</span>
<span class="nc" id="L86">        } catch (IOException e1) { </span>
<span class="nc" id="L87">            e1.printStackTrace();</span>
<span class="nc" id="L88">            return;</span>
<span class="nc" id="L89">        } </span>
 
<span class="nc" id="L91">        AudioFormat format = audioInputStream.getFormat();</span>
<span class="nc" id="L92">        SourceDataLine auline = null;</span>
<span class="nc" id="L93">        DataLine.Info info = new DataLine.Info(SourceDataLine.class, format);</span>
 
        try { 
<span class="nc" id="L96">            auline = (SourceDataLine) AudioSystem.getLine(info);</span>
<span class="nc" id="L97">            auline.open(format);</span>
<span class="nc" id="L98">        } catch (LineUnavailableException e) { </span>
<span class="nc" id="L99">            e.printStackTrace();</span>
<span class="nc" id="L100">            return;</span>
<span class="nc" id="L101">        } catch (Exception e) { </span>
<span class="nc" id="L102">            e.printStackTrace();</span>
<span class="nc" id="L103">            return;</span>
<span class="nc" id="L104">        } </span>
 
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (auline.isControlSupported(FloatControl.Type.PAN)) { </span>
<span class="nc" id="L107">            FloatControl pan = (FloatControl) auline</span>
<span class="nc" id="L108">		.getControl(FloatControl.Type.PAN);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (curPosition == Position.RIGHT) </span>
<span class="nc" id="L110">                pan.setValue(1.0f);</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            else if (curPosition == Position.LEFT) </span>
<span class="nc" id="L112">                pan.setValue(-1.0f);</span>
        } 
 
<span class="nc" id="L115">        auline.start();</span>
<span class="nc" id="L116">        int nBytesRead = 0;</span>
<span class="nc" id="L117">        byte[] abData = new byte[EXTERNAL_BUFFER_SIZE];</span>
 
        try { 
<span class="nc bnc" id="L120" title="All 2 branches missed.">            while (nBytesRead != -1) { </span>
<span class="nc" id="L121">                nBytesRead = audioInputStream.read(abData, 0, abData.length);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">                if (nBytesRead &gt;= 0) </span>
<span class="nc" id="L123">                    auline.write(abData, 0, nBytesRead);</span>
            } 
<span class="nc" id="L125">        } catch (IOException e) { </span>
<span class="nc" id="L126">            e.printStackTrace();</span>
<span class="nc" id="L127">            return;</span>
        } finally { 
<span class="nc" id="L129">            auline.drain();</span>
<span class="nc" id="L130">            auline.close();</span>
        } 
 
<span class="nc" id="L133">    } </span>
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>